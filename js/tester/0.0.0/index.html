<!DOCTYPE html>
<html lang="en">
  <head>
    <title>John Henry</title>
    <link rel="canonical" href="https://johnhenry.github.io/" />
    <meta name="description" content="John Henry's Person Portfolio and Blog" />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#343233" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta
      name="keywords"
      content="fun,math,engineering,science,experiments,programming"
    />
    <meta name="author" content="John Henry" />
    <link
      rel="icon"
      href="https://johnhenry.github.io/image/iajh.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://johnhenry.github.io/lib/css/universal-unstyled-links/0.0.0/index.css"
    />
    <link rel="stylesheet" href="https://johnhenry.github.io/lib/style.css" />
  </head>
  <body>
    
<h1 id="tester">Tester</h1>
<p>../js/tester@latest/index.mjs</p>
<p>Tester is a javascript testing framework based on <a href="https://github.com/substack/tape">Tape</a>.</p>
<p>Like Tape, tester</p>
<ul>
<li>can be run directly using <a href="https://nodejs.org">node</a> without any additional binaries or transformations.</li>
<li>produces output using the standard <a href="https://testanything.org/">Test Anything Protocol</a>.</li>
</ul>
<p>Unlike Tape, tester</p>
<ul>
<li>can be run directly in the browser or using <a href="https://deno.land">deno</a> without any additional binaries/transformations, along with node.</li>
<li>uses external assertions and makes it easy to write your own.</li>
</ul>
<h2 id="api">API</h2>
<p>Tester's API consist of two manin components:</p>
<ul>
<li>The &quot;tester&quot; function acts on a group of assertions.</li>
<li>The assertions themselves, which return errors if a given condition is not satisfied.</li>
</ul>
<h3 id="tester-1">Tester</h3>
<p>The tester function is the default export.</p>
<p>It takes as its only argument a [possibly asynchronous] generator. We call this a &quot;test&quot;.</p>
<p>Results of assertions are yielded from within the body of a test.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>

<span class="at">tester</span>(<span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="kw">yield</span> <span class="co">/*some assertion result*/</span><span class="op">;</span>
  <span class="kw">yield</span> <span class="co">/*some other assertion result*/</span><span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h3 id="assertions">Assertions</h3>
<p>The named exports are assertions.</p>
<p>Call them within a test and yield their results.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester<span class="op">,</span> <span class="op">{</span> ok<span class="op">,</span> notok <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>

<span class="at">tester</span>(<span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="kw">yield</span> <span class="at">ok</span>(<span class="kw">true</span>)<span class="op">;</span>
  <span class="kw">yield</span> <span class="at">notok</span>(<span class="kw">false</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h4 id="included-assertions">Included Assertions</h4>
<p>Besides ok and notok, there are a number of assertions included:</p>
<ul>
<li>ok -- test passes if and only if the given argument to a test is TRUTHY.</li>
<li>notok -- test passes if and only if the given argument to a test is FALSH.</li>
<li>equal -- test passes if and only if the two given arguments are THE SAME object.</li>
<li>notequal -- test passes if and only if the two given arguments are NOT THE SAME object.</li>
<li>pass -- test ALWAYS PASSES</li>
<li>fail -- test ALWAYS FAILS</li>
<li>subtestpass -- test passes if and only if the given argument is a test in which ALL THE ASSERTIONS PASS.</li>
<li>subtestfail -- test passes if and only if the given argument is a test in which AT LEAST ONE ASSERTION FAILS.</li>
<li>throws -- test passes if and only if the given function THROWS AN ERROR when called</li>
<li>doesnotthrow -- test passes if and only if the given function DOES NOT THROW AN ERROR when called</li>
</ul>
<h3 id="plan">plan</h3>
<p>When using the run function, the first argument passed to given generator is a function. We'll call it &quot;plan&quot;, but you can name it anyting you like (&quot;expect&quot;, &quot;assertions&quot;, etc.) When <em>plan</em> is called with an integer, it dictates the number of expected assertions in a given test function.</p>
<p>import tester, { ok } from &quot;./index.mjs&quot;;</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="at">tester</span>(<span class="kw">function</span><span class="op">*</span> (plan) <span class="op">{</span>
  <span class="at">plan</span>(<span class="dv">1</span>)<span class="op">;</span>
  <span class="kw">yield</span> <span class="at">ok</span>(<span class="kw">true</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h2 id="creating-assertions">Creating Assertions</h2>
<p>When creating assertions, use the examples in <em>./assertions</em> for inspiration. Here are a few things to keep in mind:</p>
<ul>
<li>Assertions are functions that test for a desired conditon.</li>
<li>If the given conditions meet the desired conditions,</li>
<li>an accepted message is returned.</li>
<li>Otherwise, an instance of TestError is returned.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> TestError <span class="im">from</span> <span class="st">&quot;./testerror.mjs&quot;</span><span class="op">;</span>

<span class="kw">const</span> assertion <span class="op">=</span> (<span class="co">/*given conditions*/</span>)<span class="op">=&gt;{</span>
  <span class="cf">if</span>(<span class="co">/*conditions are met*/</span>)<span class="op">{</span>
    <span class="cf">return</span> <span class="co">/*some message*/</span><span class="op">;</span>
  <span class="op">}</span>
  <span class="cf">return</span> <span class="kw">new</span> <span class="at">TestError</span>(<span class="co">/*some message*/</span>)<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h3 id="conventions">Conventions</h3>
<p>This library follows a specific convetion for its assertions. It's recommended that you follow these conventions when creating your own assertions, but feel free to come up with your own.</p>
<ul>
<li>The last item is an <em>operator string</em>, which is used for the TAP protocol and can be overridden.</li>
<li>The next-to-last item is a <em>default expected message</em> that can also be overridden.</li>
<li>The preceeding arguments are given conditions to be tested.</li>
<li>The returned TestError is constructed using the default expected message along with an object detailing the difference between what's expected and what's not.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> TestError <span class="im">from</span> <span class="st">&quot;./testerror.mjs&quot;</span><span class="op">;</span>

<span class="kw">const</span> assertion <span class="op">=</span> (<span class="co">/*given conditions*/</span><span class="op">,</span> message<span class="op">,</span> operatorString)<span class="op">=&gt;{</span>
  <span class="cf">if</span>(<span class="co">/*conditions are met*/</span>)<span class="op">{</span>
    <span class="cf">return</span> message<span class="op">;</span>
  <span class="op">}</span>
  <span class="cf">return</span> <span class="kw">new</span> <span class="at">TestError</span>(message<span class="op">,</span> <span class="co">/*some object*/</span>))<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h3 id="testerror-api">TestError API</h3>
<p>The test error is constructed with two items:</p>
<ul>
<li>An expected messages</li>
<li>An object who's key-value pairs are displayed as part of TAP output</li>
</ul>
<h1 id="tester-2">Tester</h1>
<p>A context-independent testing framework inspired by <a href="https://github.com/substack/tape">tape</a>.</p>
<h2 id="context-agnostic">context-agnostic</h2>
<p>Tests run in same context as your application. No special executables needed.</p>
<h2 id="tap-output">TAP Output</h2>
<p>Tester outputs to the console using a partial implementation of the <a href="https://testanything.org/tap-specification.html">Test Anything Protocol</a>.</p>
<h2 id="usage">Usage</h2>
<p>The default export of ./index.mjs is an asynchronous function, <em>tester</em>, that takes a test in the form of an asynchronous iterator.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
await <span class="at">tester</span>(async <span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="co">/* define test here s*/</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h3 id="title">Title</h3>
<p>Optionally <em>tester</em> takes a string as it's first argument. This will be printed out before each test.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
await <span class="at">tester</span>(<span class="st">&quot;test title&quot;</span><span class="op">,</span> async <span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="co">/* define test here s*/</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h3 id="definition-and-format">Definition and format</h3>
<p>When creating a test, simply yield the result of an assertion.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="im">import</span> ok <span class="im">from</span> <span class="st">&quot;./assertions/ok.mjs&quot;</span><span class="op">;</span>
await <span class="at">tester</span>(<span class="st">&quot;test title&quot;</span><span class="op">,</span> async <span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="kw">yield</span> <span class="at">ok</span>(<span class="kw">true</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>There are 7 built in assertions included alongside the default export for convinience.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester<span class="op">,</span> <span class="op">{</span>
  ok<span class="op">,</span>
  notok<span class="op">,</span>
  equal<span class="op">,</span>
  notequal<span class="op">,</span>
  deepequal<span class="op">,</span>
  pass<span class="op">,</span>
  fail<span class="op">,</span>
<span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span></code></pre></div>
<h3 id="with-plan-argument">with plan argument</h3>
<p>The first argument to the test is a <em>plan</em> function which is used to announce then number of tests before they take place via TAP.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> tester <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="im">import</span> ok <span class="im">from</span> <span class="st">&quot;./assertions/ok.mjs&quot;</span><span class="op">;</span>
await <span class="at">tester</span>(<span class="st">&quot;test title&quot;</span><span class="op">,</span> async <span class="kw">function</span><span class="op">*</span> (plan) <span class="op">{</span>
  <span class="at">plan</span>(<span class="dv">1</span>)<span class="op">;</span>
  <span class="kw">yield</span> <span class="at">ok</span>(<span class="kw">true</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h2 id="assetions">assetions</h2>
<p>Assertions are functions. They take any number of arguments and return either a success message string or an instance of TestError (&quot;/testerror.mjs&quot;).</p>
<h3 id="included-assertions-1">included assertions</h3>
<h4 id="ok">ok</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> ok <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;/index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">ok</span>(<span class="kw">true</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="notok">notok</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> notok <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;/index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">notok</span>(<span class="kw">false</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="equal">equal</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> equal <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;/index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">equal</span>(<span class="kw">true</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="notequal">notequal</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> notequal <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">notequal</span>(<span class="kw">true</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="deepequal">deepequal</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> deepequal <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">deepequal</span>(<span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="kw">true</span> <span class="op">},</span> <span class="op">{</span> <span class="dt">a</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="pass">pass</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> pass <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">pass</span>()<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="fail">fail</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> fail <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> <span class="at">fail</span>()<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="subtestpass">subtestpass</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> subtestpass<span class="op">,</span> pass <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> await <span class="at">subtestpass</span>(<span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="kw">yield</span> <span class="at">pass</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="subtestfail">subtestfail</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">import</span> <span class="op">{</span> subtestfail<span class="op">,</span> fail <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./index.mjs&quot;</span><span class="op">;</span>
<span class="kw">const</span> result <span class="op">=</span> await <span class="at">subtestfail</span>(<span class="kw">function</span><span class="op">*</span> () <span class="op">{</span>
  <span class="kw">yield</span> <span class="at">fail</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>
<span class="cf">if</span> (result <span class="kw">instanceof</span> Error) <span class="op">{</span>
  <span class="cf">throw</span> result<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h3 id="creating-external-assertions">creating external assertions</h3>
<p>Assertions have the following general form:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">export</span> <span class="im">default</span> (...<span class="at">args</span>) <span class="op">=&gt;</span> <span class="op">{</span>
  <span class="cf">if</span>(<span class="co">/*test of args passes*/</span>)<span class="op">{</span>
    <span class="co">// return a string to indicate success.</span>
  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
    <span class="co">// return instance of TestError</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h2 id="taprunner-print-run">TAPRunner, print, run</h2>
<p>The file &quot;/TAPRunner.mjs&quot; export methods &quot;print&quot; and &quot;run&quot;. &quot;print&quot; functions similarly to the default export of &quot;index.mjs&quot; -- both of which rely on &quot;run&quot; to execute underlying code.</p>
<p>When called with as single argument (a test), &quot;run&quot; yields only the results of the test (string or Error) without additional processing.</p>
  </body>
</html>
